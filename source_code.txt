#Jumlah dosen yang aktif menggunakan SHARE ITS tiap tahun
import pyodbc
import pandas as pd
import matplotlib.pyplot as plt

conn = pyodbc.connect("Driver={SQL Server};"
                      "Server=;"
                      "Database=db_final;"
                      "Trusted_Connection=yes;")
cursor = conn.cursor()
sql = cursor.execute("SELECT distinct  tahun, count(dosen) FROM [db_final].[dbo].[hasil1] group by tahun order by tahun ")
rows = sql.fetchall() 
df = pd.DataFrame( [[ij for ij in i] for i in rows] )
df.rename(columns={0: 'Tahun', 1: 'Jumlah'}, inplace=True)
x = df['Tahun']
y = df['Jumlah']

plt.title ('Jumlah Dosen yang AKtif Menggunakan SHARE ITS')
plt.plot(x, y,  c='blue')

plt.show()

df

#Jumlah dosen keseluruhan
import pyodbc
import pandas as pd
import matplotlib.pyplot as plt

conn = pyodbc.connect("Driver={SQL Server};"
                      "Server=DESKTOP-GJ6RFA5;"
                      "Database=db_final;"
                      "Trusted_Connection=yes;")
cursor = conn.cursor()
sql = cursor.execute("select count (distinct dosen) FROM dbo.Dosen")
result = sql.fetchall() 
for row in result:
     print(row)

#Perbandingan jumlah email yang digunakan oleh dosen di ITS
import pandas as pd
import matplotlib.pyplot as plt

conn = pyodbc.connect("Driver={SQL Server};"
                      "Server=DESKTOP-GJ6RFA5;"
                      "Database=db_final;"
                      "Trusted_Connection=yes;")
cursor = conn.cursor()
def its(conn):
    sql = cursor.execute("select count (distinct Email) from dbo.Dosen where Email like '%its.ac.id%'")
    result = sql.fetchall() 
    for row in result:
         return(row[0])
def gmail(conn):
    sql = cursor.execute("select count (distinct Email) from dbo.Dosen where Email like '%gmail%'")
    result = sql.fetchall() 
    for row in result:
         return(row[0])
def yahoo(conn):
    sql = cursor.execute("select count (distinct Email) from dbo.Dosen where Email like '%yahoo%'")
    result = sql.fetchall() 
    for row in result:
         return(row[0])
its(conn)
gmail(conn)
yahoo(conn)

x = ['ITS', 'GMAIL', 'YAHOO']
y = [its(conn), gmail(conn), yahoo(conn)]
plt.bar(x, y)
plt.show()

#Cari dosen dengan jumlah terbanyak akses share its selama 3 bulan
import pyodbc
import pandas as pd
import matplotlib.pyplot as plt

conn = pyodbc.connect("Driver={SQL Server};"
                      "Server=DESKTOP-GJ6RFA5;"
                      "Database=db_final;"
                      "Trusted_Connection=yes;")

cursor = conn.cursor()
sql = cursor.execute("SELECT TOP 5 d.Dosen, COUNT(*) AS jml_akses FROM dbo.Dosen d join dbo.Login l on d.Dosen=l.users WHERE l.days <= 190 GROUP BY d.Dosen HAVING (COUNT(d.Dosen) > 1) ORDER BY jml_akses DESC")
result = sql.fetchall()
df=pd.DataFrame([ij for ij in i] for i in result)
df.rename(columns={0: 'Jumlah', 1:'Dosen'}, inplace = True)

y = df['Dosen']
x = df['Jumlah']
plt.title ('Dosen yang Terbanyak Mengakses SHARE ITS Selama 3 Bulan Terakhir')
df
plt.barh(x, y)
plt.show()

df

#Mata kuliah apa saja yang diampu oleh dosen X
import pyodbc
import pandas as pd
import matplotlib.pyplot as plt

conn = pyodbc.connect("Driver={SQL Server};"
                      "Server=DESKTOP-GJ6RFA5;"
                      "Database=db_final;"
                      "Trusted_Connection=yes;")

cursor = conn.cursor()
sql = cursor.execute("SELECT DISTINCT Matakuliah FROM dbo.Dosen where Dosen='Ahmad Muklason, Ph.D 198203022009121009'")
result = sql.fetchall()

for row in result:
     print(row)

#Daftar 5 mahasiswa yang sering mengakses ShareITS pada bulan Nopember
import pyodbc
import pandas as pd
import matplotlib.pyplot as plt

conn = pyodbc.connect("Driver={SQL Server};"
                      "Server=DESKTOP-GJ6RFA5;"
                      "Database=db_final;"
                      "Trusted_Connection=yes;")
cursor = conn.cursor()
sql = cursor.execute("SELECT TOP (5) Mahasiswa, count (Tanggal) as jumlah, tanggal from dbo.MHS where Month(Tanggal)=11 and year(Tanggal)= 2018 group by Mahasiswa, tanggal order by jumlah desc")
result = sql.fetchall()
df=pd.DataFrame([ij for ij in i] for i in result)
df.rename(columns={0: 'Mahasiswa', 1:'Jumlah', 2:'Tanggal'}, inplace = True)
y = df['Jumlah']
x = df['Mahasiswa']
plt.title ('Mahasiswa yang Sering Mengakses ShareITS pada Bulan Nopember')
df
plt.barh(x, y)
plt.show()

df

#Top 10 dosen yang paling banyak mengakses ShareITS
import pyodbc
import pandas as pd
import matplotlib.pyplot as plt

conn = pyodbc.connect("Driver={SQL Server};"
                      "Server=DESKTOP-GJ6RFA5;"
                      "Database=db_final;"
                      "Trusted_Connection=yes;")
cursor = conn.cursor()
sql = cursor.execute("SELECT TOP 10 d.Dosen, COUNT(*) AS jml_akses FROM dbo.Dosen d join dbo.Login l on d.Dosen=l.users WHERE l.days <= 190 GROUP BY d.Dosen HAVING (COUNT(d.Dosen) > 1) ORDER BY jml_akses DESC;")
result = sql.fetchall() 
df=pd.DataFrame([ij for ij in i] for i in result)
df.rename(columns={0: 'Dosen', 1:'Jumlah'}, inplace = True)
print (df)
y=df['Dosen']
x=df['Jumlah']
plt.title ('Dosen Terbanyak Akses Share ITS')
plt.plot(x,y)
plt.show()

#Top 10 Mahasiswa yang paling banyak mengakses ShareITS
import pyodbc
import pandas as pd
import matplotlib.pyplot as plt

conn = pyodbc.connect("Driver={SQL Server};"
                      "Server=DESKTOP-GJ6RFA5;"
                      "Database=db_final;"
                      "Trusted_Connection=yes;")
cursor = conn.cursor()
sql = cursor.execute("SELECT TOP 10 d.Mahasiswa, COUNT(*) AS jml_akses FROM dbo.MHS d join dbo.Login l on d.Mahasiswa=l.users WHERE l.days <= 190 GROUP BY d.Mahasiswa HAVING (COUNT(d.Mahasiswa) > 1) ORDER BY jml_akses DESC;")
result = sql.fetchall() 
#for row in result:
#     print(row)
df=pd.DataFrame([ij for ij in i] for i in result)
df.rename(columns={0: 'Mahasiswa', 1:'Jumlah'}, inplace = True)
print (df)
y=df['Mahasiswa']
x=df['Jumlah']
plt.title ('Mahasiswa Terbanyak Akses Share ITS')
#plt.barh(x,y)
plt.plot(x,y)
#plt.scatter(x,y)
plt.show()

#Jumlah mhs keseluruhan
import pyodbc
import pandas as pd
import matplotlib.pyplot as plt

conn = pyodbc.connect("Driver={SQL Server};"
                      "Server=DESKTOP-GJ6RFA5;"
                      "Database=db_final;"
                      "Trusted_Connection=yes;")
cursor = conn.cursor()
sql = cursor.execute("select count (distinct mahasiswa) FROM dbo.MHS")
result = sql.fetchall() 
for row in result:
     print(row)

#Jumlah mhs yang aktif menggunakan SHARE ITS tiap tahun
import pyodbc
import pandas as pd
import matplotlib.pyplot as plt

conn = pyodbc.connect("Driver={SQL Server};"
                      "Server=;"
                      "Database=db_final;"
                      "Trusted_Connection=yes;")
cursor = conn.cursor()
sql = cursor.execute("SELECT distinct  tahun, count(mahasiswa) FROM [db_final].[dbo].[hasil2] group by tahun order by tahun ")
rows = sql.fetchall() 
df = pd.DataFrame( [[ij for ij in i] for i in rows] )
df.rename(columns={0: 'Tahun', 1: 'Jumlah'}, inplace=True)
x = df['Tahun']
y = df['Jumlah']

plt.title ('Jumlah Mahasiswa yang Aktif Menggunakan SHARE ITS')
plt.plot(x, y,  c='blue')

plt.show()

df